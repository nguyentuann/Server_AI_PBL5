<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>WebSocket AI Process Test</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 1rem;
    }
    #messages {
      border: 1px solid #ccc;
      padding: 1rem;
      height: 200px;
      overflow-y: scroll;
    }
  </style>
</head>
<body>
  <h2>WebSocket AI Process Auto Sender</h2>
  <div id="messages">Connecting...</div>

  <script src="https://cdn.jsdelivr.net/npm/sockjs-client@1/dist/sockjs.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/stompjs@2.3.3/lib/stomp.min.js"></script>
  <script>
    let stompClient = null;

    function connect() {
      // Kết nối đến WebSocket server với localhost:8696 và context-path gym-pose
      
      const socket = new SockJS('https://06e6-2a09-bac5-d5c8-263c-00-3cf-31.ngrok-free.app/gym-pose/ws'); // context-path + endpoint
      stompClient = Stomp.over(socket);

      stompClient.connect({}, () => {
        log('✅ Connected to WebSocket');

        stompClient.subscribe('/pose-error', (msg) => {
          log(`Server: ${msg.body}`);
        });

        // Gửi message mỗi 5 giây
        setInterval(() => {
          const message = {
            user_id: "user123",
            key_points: {
              x: Math.random().toFixed(2),
              y: Math.random().toFixed(2),
              confidence: (Math.random() * 100).toFixed(1)
            }
          };

          stompClient.send("/app/client/message", {}, JSON.stringify(message));
          log(`Sent: ${JSON.stringify(message)}`);
        }, 5000);
      });
    }

    function log(msg) {
      const div = document.getElementById('messages');
      div.innerHTML += `<div>${msg}</div>`;
    }

    connect();
  </script>
</body>
</html>