<!-- <!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bluetooth WebRTC Connection</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
        }
        .container {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
        }
        #video {
            width: 80%;
            height: 80%;
            border: 2px solid black;
        }
    </style>
</head>
<body>

<div class="container">
    <video id="video" autoplay></video>
</div>

<button id="connectBtn">Connect to Raspberry Pi</button>
<script>
    const connectBtn = document.getElementById("connectBtn");
    const videoElement = document.getElementById("video");

    let btDevice = null;
    let btServer = null;
    let btCharacteristic = null;

    connectBtn.addEventListener("click", async () => {
        try {
            // Kết nối Bluetooth với Raspberry Pi, sử dụng UUID hợp lệ cho dịch vụ SPP
            btDevice = await navigator.bluetooth.requestDevice({
                filters: [{ services: ['0000ffe0-0000-1000-8000-00805f9b34fb'] }]  // UUID hợp lệ cho SPP
            });

            btServer = await btDevice.gatt.connect();
            console.log("Bluetooth device connected");

            // Đọc và viết dữ liệu Bluetooth qua các đặc tính của dịch vụ
            btCharacteristic = await btServer.getPrimaryService('0000ffe0-0000-1000-8000-00805f9b34fb')
                                             .getCharacteristic('0000ffe1-0000-1000-8000-00805f9b34fb');  // UUID cho characteristic

            // Khi kết nối thành công, thiết lập WebRTC
            startWebRTC();
        } catch (err) {
            console.error("Bluetooth connection failed:", err);
        }
    });

    async function startWebRTC() {
        // WebRTC PeerConnection setup
        const pc = new RTCPeerConnection({
            iceServers: [
                {
                    urls: "stun:stun.l.google.com:19302"
                }
            ]
        });

        pc.onicecandidate = ({ candidate }) => {
            if (candidate) {
                // Gửi ICE candidate qua Bluetooth
                const candidateMessage = {
                    type: "candidate",
                    candidate: {
                        candidate: candidate.to_sdp(),
                        sdpMid: candidate.sdpMid,
                        sdpMLineIndex: candidate.sdpMLineIndex
                    }
                };
                btCharacteristic.writeValue(new TextEncoder().encode(JSON.stringify(candidateMessage)));
            }
        };

        // Thiết lập video stream
        pc.ontrack = (event) => {
            videoElement.srcObject = event.streams[0];
        };

        try {
            const offer = await pc.createOffer();
            await pc.setLocalDescription(offer);

            const offerMessage = {
                type: "offer",
                offer: {
                    sdp: pc.localDescription.sdp,
                    type: pc.localDescription.type
                }
            };
            btCharacteristic.writeValue(new TextEncoder().encode(JSON.stringify(offerMessage)));

        } catch (err) {
            console.error("Error during WebRTC setup:", err);
        }
    }
</script>

</body>
</html> -->

<!DOCTYPE html>
<html>
<head>
    <title>Bluetooth Scan</title>
</head>
<body>
    <button id="scanBtn">Scan for Bluetooth devices</button>
    <ul id="devicesList"></ul>

    <script>
        document.getElementById("scanBtn").addEventListener("click", async () => {
            try {
                const device = await navigator.bluetooth.requestDevice({
                    acceptAllDevices: true
                });
                const devicesList = document.getElementById("devicesList");
                const listItem = document.createElement("li");
                listItem.textContent = `Device found: ${device.name}`;
                devicesList.appendChild(listItem);
            } catch (error) {
                console.error("Bluetooth scan failed: ", error);
            }
        });
    </script>
</body>
</html>
